<!DOCTYPE html>
<html>

<head>
  <title>React + Spring</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

</head>

<body>
  <div id='root'></div>

  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.js"></script> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.css">
  <!-- <script src="https://fb.me/react-15.0.1.js"></script>
  <script src="https://fb.me/react-dom-15.0.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js">
  </script>
  <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
  <script src="https://unpkg.com/@material-ui/core/umd/material-ui.development.js" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script type="text/babel">

  const {
    colors,
  
  CssBaseline,
  Dialog,
  DialogActions,
  DialogContent,
  DialogContentText,
  DialogTitle,
  Icon,
  Button,
Table,
TableBody,
TableCell,
TableHead,
TableRow,
Paper,
PropTypes,
createMuiTheme,
  MuiThemeProvider,
  Typography,
  withStyles,
} = window['material-ui'];

// const theme = createMuiTheme({
//   palette: {
//     primary: {
//       light: colors.purple[300],
//       main: colors.purple[500],
//       dark: colors.purple[700],
//     },
//     secondary: {
//       light: colors.green[300],
//       main: colors.green[500],
//       dark: colors.green[700],
//     },
//   },
//   typography: {
//     useNextVariants: true,
//   },
// });
const styles = theme => ({
  root: {
   width: '100%',
    marginTop: theme.spacing.unit * 3,
    overflowX: 'auto',
    
  },
  icon: {
    marginRight: theme.spacing.unit,
  },
 table: {
    minWidth: 700,
  },
});


    var EMPLOYEES = [];

class CreateToggle extends React.Component {
    constructor(props, context) {
        super(props, context);

        this.state = {
            active: false,
        };

        this.handleClick = this.handleClick.bind(this);
    }

    handleClick() {
        this.setState({
            active: !this.state.active
        });
    }

    render() {
        return (
            <div>
                

                {this.state.active && <Create />}

                <button type="button" onClick={this.handleClick}>
                    Toggle
                </button>

            </div>
        )
    }
}

class Create extends React.Component {

constructor(props) {
        super(props);
        this.state={
          temp:{
            name:'',
            quality:'',
            quantity:'',
            price:''
          }
        }
        // this.create = this.create.bind(this);
        this.handleEvent = this.handleEvent.bind(this);
        this.handleSubmit = this.handleSubmit.bind(this);
        // this.fetchdata1 = this.fetchdata1.bind(this);
        }

//    create() {
//    return {employees: []};
//  }

 handleEvent(key) {
 

   return (event) => {
          var temp = Object.assign({}, this.state.temp);
          temp[key] = event.target.value;
          this.setState({temp: temp});
        }
  // return (event) => {
  // self.setState({name: event.target.value});
  // }
 }
 handleSubmit(event) {
    event.preventDefault();
    const data = new FormData(event.target);
    
    fetch('http://localhost:8080/api/create', {
      method: 'POST',
      body: data,
    });
  }

//  fetchdata1() {
//     var self = this;
//     $.ajax({
//         type: 'PUT',
//       url: "http://localhost:8080/create",
      
//       success: function(result) {
//         self.setState({});
//       },
      
    
//     });
//   }


// onCreate(temp) {

// }




//  fetchdata1(){this.fetchdata("PUT",this.state.temp)}

// fetchdata(method,parameter){

// var that=this;

// // parameter.id="kjhgkjfdhkj";

// console.log(parameter);

// axios.put('http://localhost:8080/create',{params:parameter})

// .then(function (response) {

// console.log(response);

// return response;

// })

// .catch(function (error) {

// console.log(error);

// return error;

// });

// }

  render() {
    return ( <div>
    <form onSubmit={this.handleSubmit} method="POST">
    <input type="text" value={this.state.temp.name} name ="name" onChange={this.handleEvent('name')} />
    <input type="text" value={this.state.temp.quality} name ="quality" onChange={this.handleEvent('quality')}/>
    <input type="text" value={this.state.temp.quantity}  name ="quantity" onChange={this.handleEvent('quantity')}/>
    <input type="text" value={this.state.temp.price}  name ="price" onChange={this.handleEvent('price')}/>
    <button  type="submit">Submit</button>
    </form>
    </div> );
  }
};
 

  class EmployeeTable extends React.Component {

    constructor(props) {
        super(props);
        
        
        }


 render() {
  const { classes } = this.props;
    var rows = [];
    this.props.employees.forEach(function(employee) {
      rows.push(<Employee employee={employee} />);
    });
    return (
        <div className="container">
          <Paper >
            <Table>
  
              <TableHead>
          <TableRow>
            <TableCell>Name</TableCell>
              <TableCell>Quality</TableCell>
                <TableCell>Quantity</TableCell>
                  <TableCell>Price</TableCell>
                </TableRow>
        </TableHead>
        <TableBody>{rows} </TableBody>
      </Table>
    </Paper>
</div>);
  }
};
         
class App extends React.Component {
 

 constructor(props) {
        super(props);
        this.state={
          employees : []
          
        }
        
        this.loadEmployeesFromServer = this.loadEmployeesFromServer.bind(this);
        // this.getInitialState = this.getInitialState.bind(this);
        // this.componentDidMount = this.componentDidMount.bind(this);
        }


 loadEmployeesFromServer() {
   var self = this;
   $.ajax({
     url: "http://localhost:8080/api/employees"
   }).then(function (data) {
     self.setState({employees: data._embedded.employees});
   });
 }

  //  getInitialState() {
  //    return {employees: []};
  //  }

   componentDidMount() {
     this.loadEmployeesFromServer();
   }
 
 render() {
  
   
  var self = this;
 
   $.ajax({
     url: "http://localhost:8080/api/employees"
   }).then(function (data) {
     self.setState({employees: data._embedded.employees});
   });
   
   return (
     <div>
     <CreateToggle  />
     <EmployeeTable employees={this.state.employees}/></div> );
      
 }
};


class Employee extends React.Component {

   constructor(props) {
        super(props);
        this.state={
          display: true
        }
        // this.getInitialState = this.getInitialState.bind(this);
        this.handleDelete = this.handleDelete.bind(this);
        // this.componentDidMount = this.componentDidMount.bind(this);
        }


  // getInitialState() {
  //   return {display: true };
  // } 
  handleDelete() {
    var self = this;
    $.ajax({
        type: 'DELETE',
      url: self.props.employee._links.self.href,
      
      success: function(result) {
        self.setState({});
      },
      
    
    });
  }

  render() {
    if (this.state.display==false) return null;
    else return (
      <TableRow>
        <TableCell>{this.props.employee.name}</TableCell>
          <TableCell>{this.props.employee.quality}</TableCell>
            <TableCell>{this.props.employee.quantity}</TableCell>
              <TableCell>{this.props.employee.price}</TableCell>
        <TableCell>
          <button className="btn btn-info" onClick={this.handleDelete}>Delete</button>
        </TableCell>
      </TableRow>
    );
  }
}; 
      

        ReactDOM.render(<App />, document.getElementById('root'));
        </script>
</body>

</html>