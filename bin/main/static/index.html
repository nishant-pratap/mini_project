<!DOCTYPE html>
<html>

<head>
  <title>React + Spring</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

</head>

<body>
  <div id='root'></div>

  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.js"></script> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.css">
  <!-- <script src="https://fb.me/react-15.0.1.js"></script>
  <script src="https://fb.me/react-dom-15.0.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js">
  </script>
  <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
  <script src="https://unpkg.com/@material-ui/core/umd/material-ui.production.min.js" crossorigin="anonymous"></script> 


  <script type="text/babel">
    var EMPLOYEES = [];

class Create extends React.Component {

constructor(props) {
        super(props);
        this.state={
          temp:{
            name:'',
            age:'',
            years:''
          }
        }
        // this.create = this.create.bind(this);
        this.handleEvent = this.handleEvent.bind(this);
        this.handleSubmit = this.handleSubmit.bind(this);
        // this.fetchdata1 = this.fetchdata1.bind(this);
        }

//    create() {
//    return {employees: []};
//  }

 handleEvent(key) {
 

   return (event) => {
          var temp = Object.assign({}, this.state.temp);
          temp[key] = event.target.value;
          this.setState({temp: temp});
        }
  // return (event) => {
  // self.setState({name: event.target.value});
  // }
 }
 handleSubmit(event) {
    event.preventDefault();
    const data = new FormData(event.target);
    
    fetch('http://localhost:8080/api/create', {
      method: 'POST',
      body: data,
    });
  }

//  fetchdata1() {
//     var self = this;
//     $.ajax({
//         type: 'PUT',
//       url: "http://localhost:8080/create",
      
//       success: function(result) {
//         self.setState({});
//       },
      
    
//     });
//   }


// onCreate(temp) {

// }




//  fetchdata1(){this.fetchdata("PUT",this.state.temp)}

// fetchdata(method,parameter){

// var that=this;

// // parameter.id="kjhgkjfdhkj";

// console.log(parameter);

// axios.put('http://localhost:8080/create',{params:parameter})

// .then(function (response) {

// console.log(response);

// return response;

// })

// .catch(function (error) {

// console.log(error);

// return error;

// });

// }

  render() {
    return ( <div>
    <form onSubmit={this.handleSubmit} method="POST">
    <input type="text" value={this.state.temp.name} name ="name" onChange={this.handleEvent('name')} />
    <input type="text" value={this.state.temp.age} name ="age" onChange={this.handleEvent('age')}/>
    <input type="text" value={this.state.temp.years}  name ="years" onChange={this.handleEvent('years')}/>
    <button  type="submit">Submit</button>
    </form>
    </div> );
  }
};
 

  class EmployeeTable extends React.Component {

    constructor(props) {
        super(props);
        
        
        }


 render() {
      
    var rows = [];
    this.props.employees.forEach(function(employee) {
      rows.push(<Employee employee={employee} />);
    });
    return (
        <div className="container">
  <table className="table table-striped">
    <thead>
      <tr>
        <th>Name</th>
        <th>Age</th>
        <th>Years</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody>{rows}</tbody>
  </table>
</div>);
  }
};
         
class App extends React.Component {
 

 constructor(props) {
        super(props);
        this.state={
          employees : []
          
        }
        
        this.loadEmployeesFromServer = this.loadEmployeesFromServer.bind(this);
        // this.getInitialState = this.getInitialState.bind(this);
        // this.componentDidMount = this.componentDidMount.bind(this);
        }


 loadEmployeesFromServer() {
   var self = this;
   $.ajax({
     url: "http://localhost:8080/api/employees"
   }).then(function (data) {
     self.setState({employees: data._embedded.employees});
   });
 }

  //  getInitialState() {
  //    return {employees: []};
  //  }

   componentDidMount() {
     this.loadEmployeesFromServer();
   }
 
 render() {
  
   
  var self = this;
 
   $.ajax({
     url: "http://localhost:8080/api/employees"
   }).then(function (data) {
     self.setState({employees: data._embedded.employees});
   });
   return (
     <div>
     <Create employees={this.state.employees} />
     <EmployeeTable employees={this.state.employees}/></div> );
      
 }
};


class Employee extends React.Component {

   constructor(props) {
        super(props);
        this.state={
          display: true
        }
        // this.getInitialState = this.getInitialState.bind(this);
        this.handleDelete = this.handleDelete.bind(this);
        // this.componentDidMount = this.componentDidMount.bind(this);
        }


  // getInitialState() {
  //   return {display: true };
  // } 
  handleDelete() {
    var self = this;
    $.ajax({
        type: 'DELETE',
      url: self.props.employee._links.self.href,
      
      success: function(result) {
        self.setState({});
      },
      
    
    });
  }

  render() {
    if (this.state.display==false) return null;
    else return (
      <tr>
        <td>{this.props.employee.name}</td>
        <td>{this.props.employee.age}</td>
        <td>{this.props.employee.years}</td>
        <td>
          <button className="btn btn-info" onClick={this.handleDelete}>Delete</button>
        </td>
      </tr>
    );
  }
}; 
      

        ReactDOM.render(<App />, document.getElementById('root'));
        </script>
</body>

</html>